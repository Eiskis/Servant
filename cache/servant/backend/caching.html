
<!DOCTYPE html>
<html>
	<head>

		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<style type="text/css">@-ms-viewport{width: device-width;}</style>

		<title>Servant</title>
		<link rel="shortcut icon" href="/servant/themes/default/servant.ico" type="image/x-icon"><link rel="stylesheet" href="/servant/themes/default/_reset.css" media="screen"><link rel="stylesheet" href="/servant/themes/default/defaults.css" media="screen"><link rel="stylesheet" href="/servant/themes/default/look.css" media="screen"><link rel="stylesheet" href="/servant/themes/default/mainmenu.css" media="screen"><link rel="stylesheet" href="/servant/themes/default/text.css" media="screen">
	</head>

	<body class="backend caching">

		<div id="mainmenu">

			<div class="first">
				<ol class="plain push-left block reset"><li class="reset"><a href="/servant/read/servant/about/">About</a></li><li class="selected"><a href="/servant/read/servant/backend/"><strong>Backend</strong></a></li><li class="reset"><a href="/servant/read/servant/get-started/">Get started</a></li><li class="reset"><a href="/servant/read/servant/sites/">Sites</a></li><li class="reset"><a href="/servant/read/servant/templates/">Templates</a></li><li class="reset"><a href="/servant/read/servant/themes/">Themes</a></li><li class="reset"><a href="/servant/read/servant/tutorials/">Tutorials</a></li></ol><select class="hidden" onchange="window.open(this.options[this.selectedIndex].value,'_top')"><optgroup label="About"></optgroup><optgroup label="Backend"></optgroup><optgroup label="Get started"></optgroup><optgroup label="Sites"></optgroup><optgroup label="Templates"></optgroup><optgroup label="Themes"></optgroup><optgroup label="Tutorials"></optgroup></select>
				<div class="clear"></div>
			</div>
			
				<div class="second">
					<ol class="plain push-left block reset">
					<li class="reset selected"><a href="/servant/read/servant/backend/caching/">Caching</a></li><li class="reset"><a href="/servant/read/servant/backend/classes/">Classes</a></li><li class="reset"><a href="/servant/read/servant/backend/settings/">Settings</a></li>
					</ol>
					<div class="clear"></div>
				</div>
			
			<div class="clear"></div>
		</div>
		
		<div class="buffer" id="content">
			<div class="contentarea">
				
					<h1>Caching</h1>
					<p>Proot's backend takes care of creating cache files, cleaning them up, sending them to browsers and setting cache headers. This is done globally for all backend actions based on just a couple of settings.</p>

<p>Proot's caching system is very robust. Instead of scheduled jobs creating and destroying cache items in the background, generated responses from actions are saved as they are used, and also overwritten with newer versions automatically. If cache items are deleted for any reason, they are simply recreated while the action is used. If a cache item is unavailable or caching is broken for any reason, actions will still generate and output a response for the client.</p>

<h2>Cache files saved on the server (i.e. <em>backend cache</em>)</h2>

<p>Proot can save the response generated by an action into a file. Next time a request comes in with the same parameters, this file will be shown instead of generating a new response, so long as the file isn't expired.</p>

<p>Caching behavior needs to be enabled <strong>both</strong> globally and by each action. The expiration time of cache files is set, in minutes, in <code>$settings['cache']</code> and <code>$action['cache']</code>. The shorter time of these two will be used.</p>

<p>Cached responses are saved in <code>cache/appname/actionparent/actionname/</code>. Cache directories are created automatically.</p>

<p><strong>Advanced usage:</strong> the name of a cache file contains serialized input parameters in an encoded format. Use the function <code>cachename_decode()</code> to get these parameters in an array.</p>

<h2>Cache saved in user's browser (i.e. <em>browser cache</em>)</h2>

<p>Proot will output valid cache headers with responses. These headers report an expiration time, after which the browser should make a new request to the server instead of remembering the previous one.</p>

<p>The expiration time is controlled both globally and by each action: Set a global maximum cache time, in minutes, in <code>$settings['browser cache']</code>; set your action's cache headers in <code>$action['browser cache']</code>.</p>

<p>Cache headers will be set to <em>no-store</em> in error responses.</p>

<h2>Disabling caching</h2>

<p>Any time a cache time setting is set 0, that type of caching is disabled (either globally or for that action). The following is an example where caching is disabled in system settings when in debug mode.</p>

<h4><code>backend/hacks/after_settings.php</code></h4>

<pre><code>if ($settings['debug']) {

    // Make sure there's no caching
    $settings['cache'] = 0;
    $settings['browser cache'] = 0;

} else {

    // Save cache files for a maximum of one week, send cache headers for 12 hours
    $settings['cache'] = 7*24*60;
    $settings['browser cache'] = 12;

}
</code></pre>

				<h4><strong>Developer stuff</strong></h4>
				<pre>

array (
  'actions' => 
  array (
    0 => 'read',
  ),
  'articles' => 
  array (
    'about' => 'sites/servant/about.md',
    'backend' => 
    array (
      'caching' => 'sites/servant/backend/caching.md',
      'classes' => 'sites/servant/backend/classes.md',
      'settings' => 'sites/servant/backend/settings.md',
    ),
    'get-started' => 'sites/servant/get-started.md',
    'sites' => 
    array (
      'app-packages' => 'sites/servant/sites/app-packages.md',
      'manifest-example' => 'sites/servant/sites/manifest-example.json',
      'urls' => 'sites/servant/sites/urls.md',
      'using-backend' => 'sites/servant/sites/using-backend.md',
    ),
    'templates' => 
    array (
      'basics' => 'sites/servant/templates/basics.md',
    ),
    'themes' => 
    array (
      'scripts' => 'sites/servant/themes/scripts.md',
      'stylesheets' => 'sites/servant/themes/stylesheets.php',
    ),
    'tutorials' => 
    array (
      'customization' => 'sites/servant/tutorials/customization.md',
      'first-site' => 'sites/servant/tutorials/first-site.md',
      'installation' => 'sites/servant/tutorials/installation.md',
    ),
  ),
  'contentTypes' => 
  array (
    0 => 'txt',
    1 => 'html',
    2 => 'xhtml',
    3 => 'json',
    4 => 'csv',
    5 => 'js',
    6 => 'css',
    7 => 'xml',
    8 => 'rss',
    9 => 'pdf',
    10 => 'zip',
    11 => 'gif',
    12 => 'jpg',
    13 => 'png',
    14 => 'svg',
    15 => 'tif',
    16 => 'mpg',
    17 => 'eot',
    18 => 'otf',
    19 => 'ttf',
    20 => 'woff',
  ),
  'patterns' => 
  array (
    0 => 'base64',
    1 => 'contentType',
    2 => 'safename',
    3 => 'filename',
    4 => 'path',
    5 => 'filepath',
    6 => 'url',
    7 => 'email',
    8 => 'ip',
  ),
  'sites' => 
  array (
    0 => 'home',
    1 => 'proot',
    2 => 'servant',
  ),
  'statusCodes' => 
  array (
    0 => 100,
    1 => 101,
    2 => 102,
    3 => 200,
    4 => 202,
    5 => 203,
    6 => 204,
    7 => 205,
    8 => 206,
    9 => 207,
    10 => 208,
    11 => 250,
    12 => 226,
    13 => 300,
    14 => 301,
    15 => 302,
    16 => 303,
    17 => 304,
    18 => 305,
    19 => 306,
    20 => 307,
    21 => 308,
    22 => 400,
    23 => 401,
    24 => 402,
    25 => 403,
    26 => 404,
    27 => 405,
    28 => 406,
    29 => 407,
    30 => 408,
    31 => 409,
    32 => 410,
    33 => 411,
    34 => 412,
    35 => 413,
    36 => 414,
    37 => 415,
    38 => 416,
    39 => 417,
    40 => 418,
    41 => 420,
    42 => 422,
    43 => 423,
    44 => 424,
    45 => 425,
    46 => 426,
    47 => 428,
    48 => 429,
    49 => 431,
    50 => 444,
    51 => 449,
    52 => 450,
    53 => 451,
    54 => 452,
    55 => 453,
    56 => 454,
    57 => 455,
    58 => 456,
    59 => 457,
    60 => 458,
    61 => 459,
    62 => 460,
    63 => 461,
    64 => 462,
    65 => 494,
    66 => 495,
    67 => 496,
    68 => 497,
    69 => 499,
    70 => 500,
    71 => 501,
    72 => 502,
    73 => 503,
    74 => 504,
    75 => 505,
    76 => 506,
    77 => 507,
    78 => 508,
    79 => 509,
    80 => 510,
    81 => 511,
    82 => 551,
    83 => 598,
    84 => 599,
  ),
  'templates' => 
  array (
    0 => 'default',
    1 => 'proot',
  ),
  'themes' => 
  array (
    0 => 'default',
    1 => 'proot',
  ),
)


</pre>
				<div class="clear"></div>
			</div>
		</div>

	</body>
</html>
